function auto_grow(e){e.style.height="2px",e.style.height=e.scrollHeight+"px"}function getTgl(){var e=new Date,a=new Array(7);a[0]="Sun",a[1]="Mon",a[2]="Tue",a[3]="Wed",a[4]="Thu",a[5]="Fri",a[6]="Sat";var t=e.getDate();return a[e.getDay()]+" "+t+", "+e.getHours()+":"+e.getMinutes()}function ngirim(){if(input.value.length<3)return Materialize.toast("Pesan harus lebih dari 3 karakter..",900),!1;var e=/(<([^>]+)>)/gi,a=input.value,t=a.replace(e,""),n=sensor(replacePHP(t)),i=(new Date,getTgl());start+=1;var s={id:start,user:USER_LOGIN,pesan:n,ip:USER_IP,waktu:i};pubnub.publish({channel:channel,message:s,x:input.value=""});kirimDB(n),scrollDown()}function scrollDown(){$("html, body").animate({scrollTop:$(document).height()},600)}function kirimDB(e){$.ajax({url:"api/?q=insert&token="+token,type:"POST",data:{user:USER_LOGIN,isi:replacePHP(e),ip:USER_IP},cache:!1,success:function(e){},fail:function(e){Materialize.toast("Gaagl mengirim... karena server sibuk",2e3)}})}function dapatIP(){$.getJSON("http://jsonip.com/?callback=?",function(e){console.log(e),USER_IP=e.ip})}function lihat(){$.getJSON("api/?q=view&token="+token,function(e){"success"==e.status?$.each(e.data,function(e,a){var t=a.ip==USER_IP?"kanan":"kiri",n="kiri"==t?'<img class="circle left" height="50px" src="'+randImage()+'">':"",i="kiri"==t?'<span class="username left">'+a.user+"</span><br/>":"",s='<div class="col s12 m12 l12">';s+=n,s+='<div id="chatContainer" class="'+t+'">',s+=i,s+=strip_tags(a.chat,"<img><br><a>"),s+='<br><span class="time">'+a.jam+"</span>",s+="</div>",s+="</div>",$("#message_konten").append(s).hide().show("slow")}):Materialize.toast(e.message,5e3)}).fail(function(){Materialize.toast("Terjadi kesalahan saat mengambil data di Server..",5e3)})}var token="96804502ecb8b207a48bb7ca3859ab7435ed109e",P_KEY="pub-c-20c9ef47-104a-4870-9059-3a837cb30106",S_KEY="sub-c-f6d6072c-ea27-11e6-a5f4-02ee2ddab7fe",USER_IP,USER_LOGIN,start=0,enter_to_send=1;$(window).load(function(){getSession()?(USER_LOGIN=getSession(),notifJoin()):$("#modal1").modal("open"),getTgl(),setTimeout(dapatIP,1e3),setTimeout(lihat,2e3)}),$(document).ready(function(){$.ajaxSetup({cache:!1}),$(".tooltipped").tooltip({delay:50}),$(".button-collapse").sideNav(),$(".modal").modal({dismissible:!1,opacity:.7})}),$(document).ready(function(){$("#btn-agree").click(function(){var e=$("#ses_user").val(),a=new RegExp("^[a-zA-Z0-9]+$");return a.test(e)?($("#modal1").modal("close"),USER_LOGIN=e,localStorage.user=e,notifJoin(),void 0):($("#modal-warning").text("*Pastikan isi dengan benar"),!1)})});var pubnub=PUBNUB.init({publish_key:P_KEY,subscribe_key:S_KEY,ssl:!0}),box=PUBNUB.$("message_konten"),input=PUBNUB.$("text-message"),channel="chat";pubnub.subscribe({channel:channel,callback:function(e){var a=replacePHP(e.pesan),t=e.id,n=e.ip==USER_IP?"kanan":"kiri",i="kiri"==n?'<img class="circle left" width="50px" src="'+randImage()+'">':"",s="kiri"==n?'<span class="username left">'+e.user+"</span><br/>":"",r='<div class="col s12 m12 l12" id="cht'+t+'">';r+=i,r+='<div id="chatContainer" class="'+n+'">',r+=s,r+=strip_tags(a.nl2br(),"<img><br><a>"),r+='<br><span class="time" style="color:rgba(0,0,0,0.5);">'+e.waktu+"</span>",r+="</div>",r+="</div>",$("#message_konten").append(r),$("#cht"+t).hide(),$("#cht"+t).fadeIn("slow"),e.ip!=USER_IP&&Materialize.toast("Pesan dari: "+e.user,1e3),scrollDown()}}),pubnub.subscribe({channel:"room",callback:function(e){Materialize.toast(e,3e3)}}),$("#text-message").on("keydown",function(e){1!=enter_to_send?13===e.which&&e.altKey&&ngirim():13===e.which&&(e.preventDefault(),ngirim())}),$("#btn-send").on("click",function(){ngirim()});