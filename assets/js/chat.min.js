var PUB_KEY="pub-c-20c9ef47-104a-4870-9059-3a837cb30106",PUB_SUB_KEY="sub-c-f6d6072c-ea27-11e6-a5f4-02ee2ddab7fe",ch_chat="publik_chat",ch_join="joining",user_login,user_ip=$.cookie("user_ip"),pubnub=new PubNub({publish_key:PUB_KEY,subscribe_key:PUB_SUB_KEY,ssl:!0});pubnub.addListener({status:function(a){"PNNetworkDownCategory"===a.category&&swal("Offline","Maaf server chat sedang offline","error")},message:function(a){var b=a.message;if(a.channel==ch_chat){var c="Anda";return user_ip===b.ip?dropMessage(b.user,b.message,"left"):(c=b.user,dropMessage(b.user,b.message,"right")),toastr.info(`<b>${c}</b> mengirimkan <i>`+b.message.substr(0,50)+`...</i>`)}a.channel==ch_join&&toastr.info(b)}}),pubnub.subscribe({channels:[ch_chat,ch_join]});function getIP(){$.getJSON("https://jsonip.com/?callback=?",function(a){$.cookie("user_ip",a.ip,{expires:1})})}var BChat={version:"2.0",getDate:function(){var a=new Date,b=Array(7);b[0]="Sun",b[1]="Mon",b[2]="Tue",b[3]="Wed",b[4]="Thu",b[5]="Fri",b[6]="Sat",date=a.getDate();var c=10>a.getMinutes()?"0"+a.getMinutes():a.getMinutes();return b[a.getDay()]+" "+date+", "+a.getHours()+":"+c+":"+a.getSeconds()},refreshLogin:function(){user_login=$.cookie("uName"),$("div.chat_window").find("div.title").html(`Selamat datang <b><em>${user_login}</em></b>`),pubnub.publish({channel:ch_join,message:`<b>${user_login}</b> bergabung dengan chat`})},login:function(a){var a=this.strip_tags(a);$.cookie("uName",a,{expires:1}),this.refreshLogin()},logout:function(){swal({title:"Keluar dari chat?",text:"Anda yakin ingin meninggalkan chat?",icon:"warning",buttons:!0,dangerMode:!0}).then(a=>{a&&($.removeCookie("uName"),location.reload())})},strip_tags:function(a,b=""){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,f=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(f,"").replace(c,function(g,h){return-1<b.indexOf("<"+h.toLowerCase()+">")?g:""})}};$(window).on("load",function(){getIP(),"undefined"==typeof $.cookie("uName")?swal({title:"Masukan Nama",content:"input",closeOnClickOutside:!1}).then(a=>{BChat.login(a)}):BChat.refreshLogin()}),function(){var a;a=function(b){return this.user=b.user,this.text=b.text,this.date=b.date,this.message_side=b.message_side,this.draw=function(c){return function(){var f;return f=$($(".message_template").clone().html()),f.find(".text_user").html(c.user),f.find(".text_date").addClass(c.message_side).html(c.date),f.addClass(c.message_side).find(".text").html(c.text),$(".messages").append(f),setTimeout(function(){return f.addClass("appeared")},0)}}(this),this},$(function(){var b,c,f;return b=function(){var g;return g=$(".message_input"),g.val().substr(0,1e3)},dropMessage=function(g,h,i="right"){c=i;var j,k;if(""!==h.trim())return $(".message_input").val(""),j=$(".messages"),c="left"===c?"right":"left",k=new a({user:g,text:h,date:BChat.getDate(),message_side:c}),k.draw(),j.animate({scrollTop:j.prop("scrollHeight")},300)},f=function(){var g=BChat.strip_tags(b(),"<br><b><i><br/>"),h=BChat.getDate(),i={user:user_login,message:g,ip:user_ip,waktu:h};pubnub.publish({channel:ch_chat,message:i,callback:function(j){console.log(j)}})},$(".send_message").click(function(){return f()}),$(".message_input").keyup(function(g){if(13===g.which)return f()}),$(".button.close").click(function(){BChat.logout()}),$(".button.maximize").click(function(){swal("About me",`Created and developed by @MuhBayu`,"info")}),setTimeout(function(){return dropMessage("MuhBayu","Selamat datang di BChat","right")},1e3)})}.call(this);